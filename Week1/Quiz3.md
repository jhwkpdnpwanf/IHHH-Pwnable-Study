# **Quiz: x86 Assembly 3**

**Q1. 다음 어셈블리 코드를 실행했을 때 출력되는 결과로 올바른 것은?**

---

```nasm
[Code]
main:
    push rbp
    mov rbp, rsp
    mov esi, 0xf
    mov rdi, 0x400500
    call 0x400497 <write_n>
    mov eax, 0x0
    pop rbp
    ret
    
write_n:
    push rbp
    mov rbp, rsp
    mov QWORD PTR [rbp-0x8],rdi
    mov DWORD PTR [rbp-0xc],esi
    xor rdx, rdx
    mov edx, DWORD PTR [rbp-0xc]
    mov rsi,QWORD PTR [rbp-0x8]
    mov rdi, 0x1
    mov rax, 0x1
    syscall
    pop rbp
    ret
    
==================================    
[Memory]
0x400500 | 0x3037207964343372
0x400508 | 0x003f367562336420
```

**정답**

- **r34dy 70 d3bu6?**

**해설**

- 시작 상태

| **0x400500** | **0x3037207964343372** | ← rsp |
| --- | --- | --- |
| **0x400508** | **0x003f367562336420** |  |
- `push rbp`

| **0x4004F8** | **0x400508** | **← rsp** |
| --- | --- | --- |
| **0x400500** | **0x3037207964343372** |  |
| **0x400508** | **0x003f367562336420** | **← rbp** |
- `mov rbp, rsp`

| **0x4004F8** | **0x400508** | **← rsp, rbp** |
| --- | --- | --- |
| **0x400500** | **0x3037207964343372** |  |
| **0x400508** | **0x003f367562336420** |  |
- `mov esi, 0xf` ,`mov rdi, 0x400500`
    - `esi` = `0xf`
    - `rdi` = `0x400500`

- `call 0x400497 <write_n>`
    - `<write_n>` 호출

| **0x4004F0** | **함수 리턴 주소** |  |
| --- | --- | --- |
| **0x4004F8** | **0x400508** | **← rsp, rbp** |
| **0x400500** | **0x3037207964343372** |  |
| **0x400508** | **0x003f367562336420** |  |

`write_n:`

- `push rbp`

| **0x4004E8** | **0x4004f8** | **← rsp** |
| --- | --- | --- |
| **0x4004F0** | **함수 리턴 주소** |  |
| **0x4004F8** | **0x400508** | **← rbp** |
| **0x400500** | **0x3037207964343372** |  |
| **0x400508** | **0x003f367562336420** |  |
- `mov rbp, rsp`

| **0x4004E8** | **0x4004f8** | **← rsp,rbp** |
| --- | --- | --- |
| **0x4004F0** | **함수 리턴 주소** |  |
| **0x4004F8** | **0x400508** |  |
| **0x400500** | **0x3037207964343372** |  |
| **0x400508** | **0x003f367562336420** |  |
- `mov QWORD PTR [rbp-0x8],rdi`, `mov DWORD PTR [rbp-0xc],esi`

| **0x4004DC** | **0xF** | **(**`esi` **값) ← rsp** |
| --- | --- | --- |
| **0x4004E0** | **0x400500** | **(**`rdi` **값)** |
| **0x4004E8** | **0x4004f8** | **← rbp** |
| **0x4004F0** | **함수 리턴 주소** |  |
| **0x4004F8** | **0x400508** |  |
| **0x400500** | **0x3037207964343372** |  |
| **0x400508** | **0x003f367562336420** |  |
- `or rdx, rdx`
    - `rdx` = 0

- `mov edx, DWORD PTR [rbp-0xc]` , `mov rsi,QWORD PTR [rbp-0x8]`
    - `DWORD PTR [rbp-0xc]` = `0xF`
    - `QWORD PTR [rbp-0x8]` = `0x400500`
- `mov rdi, 0x1` , `mov rax, 0x1`
    - 버퍼 내용을 표준 출력
    - 

→ `0x400500` 부터 `0xF` (15바이트) 출력

- 나머지 코드 :  스택 원상 복귀

![image](https://github.com/user-attachments/assets/6123d6b5-3e79-4af7-8b38-727827409dfc)

(헥스 에디터라 역순으로 나옴)
